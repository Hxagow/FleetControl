{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}FleetControl{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-grotesk text-gray-700 min-h-screen bg-white flex flex-col">
    {% include 'header.html' %}
    <!-- Messages Globaux -->
    {% if messages %}
    <div class="toast-container fixed left-1/2 -translate-x-1/2 flex flex-col items-center space-y-3 px-4 z-50 pointer-events-none" data-toast-container>
        {% for message in messages %}
        {% if message.tags == 'success' %}
        <div class="toast toast-success bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative flex items-center gap-3 shadow-lg pointer-events-auto" role="alert" data-toast data-timeout="6000">
            <span class="flex-1">{{ message }}</span>
            <button type="button" class="toast-close text-green-700 hover:text-green-900" data-toast-close aria-label="{% trans 'Fermer' %}">&times;</button>
        </div>
        {% elif message.tags == 'error' %}
        <div class="toast toast-error bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative flex items-center gap-3 shadow-lg pointer-events-auto" role="alert" data-toast data-timeout="8000">
            <span class="flex-1">{{ message }}</span>
            <button type="button" class="toast-close text-red-700 hover:text-red-900" data-toast-close aria-label="{% trans 'Fermer' %}">&times;</button>
        </div>
        {% elif message.tags == 'warning' %}
        <div class="toast toast-warning bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded relative flex items-center gap-3 shadow-lg pointer-events-auto" role="alert" data-toast data-timeout="7000">
            <span class="flex-1">{{ message }}</span>
            <button type="button" class="toast-close text-yellow-800 hover:text-yellow-900" data-toast-close aria-label="{% trans 'Fermer' %}">&times;</button>
        </div>
        {% else %}
        <div class="toast toast-info bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative flex items-center gap-3 shadow-lg pointer-events-auto" role="alert" data-toast data-timeout="6000">
            <span class="flex-1">{{ message }}</span>
            <button type="button" class="toast-close text-blue-700 hover:text-blue-900" data-toast-close aria-label="{% trans 'Fermer' %}">&times;</button>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Contenu principal -->
    <main class="flex-grow container mx-auto px-4 flex items-center justify-center">
        {% block content %}
        {% endblock %}
    </main>

    {% include 'footer.html' %}

    <script>
    (function () {
        function positionToastContainer() {
            var container = document.querySelector('[data-toast-container]');
            if (!container) {
                return;
            }

            var header = document.querySelector('[data-site-header]') || document.querySelector('header');
            var offset = 16; // px
            var top = offset;

            if (header) {
                var rect = header.getBoundingClientRect();
                top = rect.bottom + offset;
            } else {
                top = 24;
            }

            container.style.top = top + 'px';
        }

        function initToast(toast) {
            if (toast.dataset.toastReady === '1') {
                return;
            }
            toast.dataset.toastReady = '1';

            var timeout = parseInt(toast.dataset.timeout || '6000', 10);
            if (isNaN(timeout) || timeout < 0) {
                timeout = 6000;
            }

            requestAnimationFrame(function () {
                toast.classList.add('toast-show');
            });

            var hasHidden = false;

            function hideToast() {
                if (hasHidden) {
                    return;
                }
                hasHidden = true;
                toast.classList.remove('toast-show');
                toast.classList.add('toast-hide');
                toast.addEventListener('transitionend', function handleTransition(e) {
                    if (e.target !== toast) {
                        return;
                    }
                    toast.removeEventListener('transitionend', handleTransition);
                    toast.remove();
                });
            }

            var timerId = window.setTimeout(hideToast, timeout);

            var closeButton = toast.querySelector('[data-toast-close]');
            if (closeButton) {
                closeButton.addEventListener('click', function () {
                    window.clearTimeout(timerId);
                    hideToast();
                });
            }
        }

        function initAllToasts() {
            document.querySelectorAll('[data-toast]').forEach(initToast);
            positionToastContainer();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAllToasts, { once: true });
        } else {
            initAllToasts();
        }

        window.addEventListener('resize', function () {
            positionToastContainer();
        });
    })();
    </script>
</body>
</html>